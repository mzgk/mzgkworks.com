+++
slug = "aws-rds-restore-from-snapshot"
title = "RDSをスナップショットから復元する方法"
tags = ["AWS"]
draft = false
description = "RDSをある時点のスナップショットから復元する方法。"
date = "2017-02-27T16:16:35+09:00"
categories = ["Usage"]

+++

以前に取得されたスナップショットからRDSを復元して、現在のRDSと付け替える方法。  
<br>
ポイントは以下。

- DBインスンタンス識別子の値は、EC2と接続するためのエンドポイントのprefixを兼ねている
- 同じ識別子で復元できない
- 別の識別子で復元 -> 既存の識別子を変更 -> 復元分の識別子を元々の識別子に変更
- これでエンドポイントの値は変更されないので、Webサーバー側との接続に影響を与えない
- **復元したインスタンスのセキュリティグループを既存と同様にセットし直す**


## スナップショットからインスタンスを復元
- RDSダッシュボード - スナップショット - 復元したいスナップショットを選択
- スナップショットのアクション - スナップショットの復元
- DBインスタンスの復元画面が表示されるので、情報を入力
  - デフォルトになっている部分を抜粋
  - マルチAZ配置 : 選択
  - DBインスタンス識別子 : **復元して置き換えたい既存インスタンスの値とは別の値**
  - アベイラビリティゾーン : 選択
- DBインスタンスの復元 - 復元される（作業状況はインスタンスで確認）


## 既存のインスタンス
- 復元したインスタンスで置き換えたいインスタンス
- DBインスタンス識別子を変更して、エンドポイントを復元インスタンスにゆずる
- 変更作業
  - インスタンスの操作 - 変更
  - DBインスタンス識別子 : 変更
  - すぐに適用 : チェック
  - 次へ - DBインスタンスの変更
- 変更中 -> 名前変更中 -> 再起動 -> 利用可能
- この時点でWebサーバーからDBが参照されなくなる


## 復元インスタンス
- 復元したインスタンスのDB識別子を既存の値に変更する（エンドポイント値の復元）
- **セキュリティグループを既存同様に付け直す**
- 変更作業
  - インスタンスの操作 - 変更
  - DBインスタンス識別子 : 変更
  - セキュリティグループ : 既存と同様のSGをセット
  - すぐに適用 : チェック
  - 次へ - DBインスタンスの変更
- 変更中 -> 名前変更中 -> 再起動 -> 利用可能
- これで復元されたDBで置き換えられる

## RDS削除時の注意（スナップショット）
- **RDSを削除する際に、過去にとった自動スナップショットは削除されてしまう**
- **復元したい場合、削除時に聞かれる「最終スナップショット」は作成しておくこと**


<br><br>
以上
