+++
categories = ["Usage"]
date = "2017-04-29T18:01:49+09:00"
description = "EBSのスナップショットからEC2インスタンスを作成する方法。"
draft = false
slug = "ec2-restore-from-ebs-snapshot"
tags = ["AWS"]
title = "AWS EBSスナップショットからのEC2リストア"

+++

EC2の状態をある時点に巻き戻したい（ある時点のEC2を再現したい）時に、EBSのスナップショットからリストアする方法。<br>
復元したい時点のスナップショットがあれば、それ以前に採取したスナップショットがなくても可能。


## 試したこと
基本、スナップショットがあれば、その時点の状態でEC2が作成（復元）できることを確認できた。<br>
こんな感じ。

1. スナップショット１：a.txt
2. スナップショット２：a.txt, b.txt
3. 現在のインスタンス：a.txt, b.txt, c.txt
4. スナップショット１を削除
5. スナップショット２で復元
6. 現在のインスタンス：a.txt, b.txt


## EBSのスナップショットを作成する
1. ボリューム：対象EBSを選択 -> スナップショットの作成


## A. ある時点のスナップショットで復元する：ルートボリューム付け替え
現在のEC2インスタンスをそのまま使用し、デバイス（EBS：ルートボリューム）の付け替えを行う方法。

1. スナップショット：対象のスナップショットを選択 -> ボリュームの作成
2. インスタンス：EBSを付替えるEC2を選択 -> 停止
  - ルートデバイスの値を控えておく（/dev/xvda）
3. ボリューム：EC2にアタッチされているEBSを選択 -> デタッチ
4. ボリューム：1で作成したボリューム（EBS）を選択 -> アタッチ
  - デバイス：2で控えたルートデバイスの値を入力（/dev/xvda）
5. インスタンス：対象のEC2を選択 -> 起動


## B. ある時点のスナップショットで復元する：新規EC2インスタンス作成
元のEC2インスタンスを残したまま、スナップショットからAMIを作成し、新規にEC2インスタンスを作成する方法。

1. スナップショット：対象のスナップショットを選択 -> イメージの作成
2. AMI：1で作成したAMIを選択 -> 作成


## 参考
- http://dev.classmethod.jp/cloud/aws/restore-ec2-from-ebs-snapshot/
