<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Aws on mzgkworks.com</title>
    <link>http://mzgkworks.com/tags/aws/index.xml</link>
    <description>Recent content in Aws on mzgkworks.com</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-JP</language>
    <atom:link href="http://mzgkworks.com/tags/aws/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>EC2上のLinuxタイムゾーンを変更する</title>
      <link>http://mzgkworks.com/post/aws-change-timezone-on-linux/</link>
      <pubDate>Tue, 28 Feb 2017 16:55:07 +0900</pubDate>
      
      <guid>http://mzgkworks.com/post/aws-change-timezone-on-linux/</guid>
      <description>

&lt;p&gt;EC2インスタンスを作成した際に、タイムゾーンをUTC -&amp;gt; JSTに変更する方法。&lt;br /&gt;
（Amazon Linux限定ではない。）&lt;/p&gt;

&lt;h2 id=&#34;タイムゾーンを変更する&#34;&gt;タイムゾーンを変更する&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;# 確認
$ date
2017年  2月 28日 火曜日 01:06:29 UTC

# UTC -&amp;gt; JSTに変更
$ sudo cp /usr/share/zoneinfo/Japan /etc/localtime

# 確認
$ date
2017年  2月 28日 火曜日 10:07:48 JST
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>EC2のスナップショットを自動作成する</title>
      <link>http://mzgkworks.com/post/aws-automatically-create-snapshot-of-ec2/</link>
      <pubDate>Tue, 28 Feb 2017 16:28:32 +0900</pubDate>
      
      <guid>http://mzgkworks.com/post/aws-automatically-create-snapshot-of-ec2/</guid>
      <description>

&lt;p&gt;EC2のスナップショットを自動（AWS CLI + Cron）で採取するための設定方法。&lt;/p&gt;

&lt;h2 id=&#34;手順&#34;&gt;手順&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;アクセス権（EC2FullAccess）があるIAMユーザーで、AWS CLIをセットアップ&lt;/li&gt;
&lt;li&gt;EC2上でawsコマンドを実行して、スナップショットが作成されていることを確認&lt;/li&gt;
&lt;li&gt;awsコマンドをシェルスクリプトファイルにして、EC2のcrontabに設定&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;1-aws-cliのセットアップ&#34;&gt;1. AWS CLIのセットアップ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;IAMダッシュボードで、使用するIAMユーザーを選択&lt;/li&gt;
&lt;li&gt;認証情報タブ -&amp;gt; アクセスキーの作成 -&amp;gt; 新規アクセスキーが作成され、.csvのダウンロードができる&lt;/li&gt;
&lt;li&gt;EC2にsshでログイン&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;# EC2（Amazon Linux）上で、AWS CLIの初期設定
$ aws configure
AWS Access Key ID [None]: .csvのAccess key ID
AWS Secret Access Key [None]: .csvのSecret access key
Default region name [None]: ap-northeast-1
Default output format [None]: json
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;2-ec2のスナップショットを採取確認&#34;&gt;2. EC2のスナップショットを採取確認&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;EC2ダッシュボードで対象インスタンスの情報を確認する

&lt;ul&gt;
&lt;li&gt;EC2.Name : 対象のEC2インスタンス&lt;/li&gt;
&lt;li&gt;EBS.ID : vol-xxxxxxxxxc0c&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;対象のEC2にssh接続をする&lt;/li&gt;
&lt;li&gt;以下のawsコマンドを実行する&lt;/li&gt;
&lt;li&gt;コマンド実行後に、EC2ダッシュボードでスナップショットを確認すると作成を実行している&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;# スナップショットを作成する
$ aws ec2 create-snapshot --volume-id vol-xxxxxxxxxc0c --description &amp;quot;説明&amp;quot;

# 結果が返ってくる
{
    &amp;quot;Description&amp;quot;: &amp;quot;入力した説明&amp;quot;,
    &amp;quot;Encrypted&amp;quot;: false,
    &amp;quot;VolumeId&amp;quot;: &amp;quot;vol-xxxxxxxxxc0c&amp;quot;,
    &amp;quot;State&amp;quot;: &amp;quot;pending&amp;quot;,
    &amp;quot;VolumeSize&amp;quot;: 8,
    &amp;quot;Progress&amp;quot;: &amp;quot;&amp;quot;,
    &amp;quot;StartTime&amp;quot;: &amp;quot;2017-02-28T01:39:43.000Z&amp;quot;,
    &amp;quot;SnapshotId&amp;quot;: &amp;quot;snap-021be12d0fc9abf3a&amp;quot;,
    &amp;quot;OwnerId&amp;quot;: &amp;quot;xxxxxx&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;3-crontabを設定&#34;&gt;3. crontabを設定&lt;/h2&gt;

&lt;h3 id=&#34;採取コマンドをシェルスクリプト化&#34;&gt;採取コマンドをシェルスクリプト化&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;backup.shというファイル名で保存する&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;#!/bin/sh
aws ec2 create-snapshot --volume-id vol-xxxxxxxxxc0c --description &amp;quot;説明&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;crontab-txtを作成&#34;&gt;crontab.txtを作成&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;毎朝４時にスナップショットを作成する設定&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ファイルの最後は改行をいれること&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;0 4 * * * /bin/sh /home/ec2-user/backup.sh

&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ec2へのアップロードと設定&#34;&gt;EC2へのアップロードと設定&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;作成した２ファイルをEC2のホーム直下にアップロード&lt;/li&gt;
&lt;li&gt;EC2上でbackup.shにec2-userのアクセス権を付与&lt;/li&gt;
&lt;li&gt;crontabに設定&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;# MacからSCPコマンドでファイルをアップロード
$ scp -i ~/.ssh/キーペアファイル.pem backup.sh crontab.txt ec2-user@EC2.IP:~/
backup.sh  100%  115    19.9KB/s   00:00
crontab.txt  100%   37     7.1KB/s   00:00
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;# EC2上で
# 実行権限を付与
$ chmod 700 backup.sh

# crontabに設定
$ crontab crontab.txt

# 確認
$ crontab -l
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;実行確認&#34;&gt;実行確認&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;実行されるとEC2上でCronからec2-user宛てにメールが届く&lt;/li&gt;
&lt;li&gt;EC2ダッシュボードでもスナップショット作成が確認できる&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;# EC2にmailコマンドをインストール
$ sudo yum install -y mailx

# mailを確認
$ mail
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;停止-crontabの削除&#34;&gt;停止（crontabの削除）&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;定期実行を停止するにはcrontabから削除を行う&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;# 削除
$ crontab -r
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>RDSをスナップショットから復元する方法</title>
      <link>http://mzgkworks.com/post/aws-rds-restore-from-snapshot/</link>
      <pubDate>Mon, 27 Feb 2017 16:16:35 +0900</pubDate>
      
      <guid>http://mzgkworks.com/post/aws-rds-restore-from-snapshot/</guid>
      <description>

&lt;p&gt;以前に取得されたスナップショットからRDSを復元して、現在のRDSと付け替える方法。&lt;br /&gt;
&lt;br&gt;
ポイントは以下。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;DBインスンタンス識別子の値は、EC2と接続するためのエンドポイントのprefixを兼ねている&lt;/li&gt;
&lt;li&gt;同じ識別子で復元できない&lt;/li&gt;
&lt;li&gt;別の識別子で復元 -&amp;gt; 既存の識別子を変更 -&amp;gt; 復元分の識別子を元々の識別子に変更&lt;/li&gt;
&lt;li&gt;これでエンドポイントの値は変更されないので、Webサーバー側との接続に影響を与えない&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;復元したインスタンスのセキュリティグループを既存と同様にセットし直す&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;スナップショットからインスタンスを復元&#34;&gt;スナップショットからインスタンスを復元&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;RDSダッシュボード - スナップショット - 復元したいスナップショットを選択&lt;/li&gt;
&lt;li&gt;スナップショットのアクション - スナップショットの復元&lt;/li&gt;
&lt;li&gt;DBインスタンスの復元画面が表示されるので、情報を入力

&lt;ul&gt;
&lt;li&gt;デフォルトになっている部分を抜粋&lt;/li&gt;
&lt;li&gt;マルチAZ配置 : 選択&lt;/li&gt;
&lt;li&gt;DBインスタンス識別子 : &lt;strong&gt;復元して置き換えたい既存インスタンスの値とは別の値&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;アベイラビリティゾーン : 選択&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;DBインスタンスの復元 - 復元される（作業状況はインスタンスで確認）&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;既存のインスタンス&#34;&gt;既存のインスタンス&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;復元したインスタンスで置き換えたいインスタンス&lt;/li&gt;
&lt;li&gt;DBインスタンス識別子を変更して、エンドポイントを復元インスタンスにゆずる&lt;/li&gt;
&lt;li&gt;変更作業

&lt;ul&gt;
&lt;li&gt;インスタンスの操作 - 変更&lt;/li&gt;
&lt;li&gt;DBインスタンス識別子 : 変更&lt;/li&gt;
&lt;li&gt;すぐに適用 : チェック&lt;/li&gt;
&lt;li&gt;次へ - DBインスタンスの変更&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;変更中 -&amp;gt; 名前変更中 -&amp;gt; 再起動 -&amp;gt; 利用可能&lt;/li&gt;
&lt;li&gt;この時点でWebサーバーからDBが参照されなくなる&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;復元インスタンス&#34;&gt;復元インスタンス&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;復元したインスタンスのDB識別子を既存の値に変更する（エンドポイント値の復元）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;セキュリティグループを既存同様に付け直す&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;変更作業

&lt;ul&gt;
&lt;li&gt;インスタンスの操作 - 変更&lt;/li&gt;
&lt;li&gt;DBインスタンス識別子 : 変更&lt;/li&gt;
&lt;li&gt;セキュリティグループ : 既存と同様のSGをセット&lt;/li&gt;
&lt;li&gt;すぐに適用 : チェック&lt;/li&gt;
&lt;li&gt;次へ - DBインスタンスの変更&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;変更中 -&amp;gt; 名前変更中 -&amp;gt; 再起動 -&amp;gt; 利用可能&lt;/li&gt;
&lt;li&gt;これで復元されたDBで置き換えられる&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;rds削除時の注意-スナップショット&#34;&gt;RDS削除時の注意（スナップショット）&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RDSを削除する際に、過去にとった自動スナップショットは削除されてしまう&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;復元したい場合、削除時に聞かれる「最終スナップショット」は作成しておくこと&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br&gt;&lt;br&gt;
以上&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Elastic Load Balancingを利用した、EC2-RDS環境の構築</title>
      <link>http://mzgkworks.com/post/aws-elb-ec2-rds-wordpress/</link>
      <pubDate>Mon, 27 Feb 2017 13:33:52 +0900</pubDate>
      
      <guid>http://mzgkworks.com/post/aws-elb-ec2-rds-wordpress/</guid>
      <description>

&lt;h2 id=&#34;0-環境&#34;&gt;0. 環境&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;異なるAZにロードバランシングされるWordPress環境を構築する&lt;/li&gt;
&lt;li&gt;VPC・Subnet（4）・Internet Gateway・Route Table・Security Group&lt;/li&gt;
&lt;li&gt;ロードバランサー

&lt;ul&gt;
&lt;li&gt;異なるAZに配置されたEC2に接続&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Webサーバー

&lt;ul&gt;
&lt;li&gt;異なるAZにEC2を1台づつ配置&lt;/li&gt;
&lt;li&gt;Public Subnet&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;DBサーバー

&lt;ul&gt;
&lt;li&gt;テスト用なのでSingle-AZ&lt;/li&gt;
&lt;li&gt;EC2からアクセス&lt;/li&gt;
&lt;li&gt;Private Subnet&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;アクセス制御

&lt;ul&gt;
&lt;li&gt;各インスタンス用にSecurity Groupを作成して制御&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&#34;1-ネットワーク領域の作成&#34;&gt;1. ネットワーク領域の作成&lt;/h2&gt;

&lt;h3 id=&#34;vpc&#34;&gt;VPC&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Sample_VPC

&lt;ul&gt;
&lt;li&gt;20.0.0.0/16&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;subnet&#34;&gt;Subnet&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;WebAP用（AZ-A）

&lt;ul&gt;
&lt;li&gt;Sample_Public_1A&lt;/li&gt;
&lt;li&gt;ap-northeast-1a&lt;/li&gt;
&lt;li&gt;20.0.1.0/24&lt;/li&gt;
&lt;li&gt;パブリックIP : はい&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;WebAP用（AZ-C）

&lt;ul&gt;
&lt;li&gt;Sample_Public_1C&lt;/li&gt;
&lt;li&gt;ap-northeast-1c&lt;/li&gt;
&lt;li&gt;20.0.2.0/24&lt;/li&gt;
&lt;li&gt;パブリックIP : はい&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;DB用（AZ-A）

&lt;ul&gt;
&lt;li&gt;Sample_Private_1A&lt;/li&gt;
&lt;li&gt;ap-northeast-1a&lt;/li&gt;
&lt;li&gt;20.0.10.0/24&lt;/li&gt;
&lt;li&gt;パブリックIP : いいえ&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;DB用（AZ-C）

&lt;ul&gt;
&lt;li&gt;Sample_Private_1C&lt;/li&gt;
&lt;li&gt;ap-northeast-1c&lt;/li&gt;
&lt;li&gt;20.0.20.0/24&lt;/li&gt;
&lt;li&gt;パブリックIP : いいえ&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;internet-gateway&#34;&gt;Internet Gateway&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Sample_IGW

&lt;ul&gt;
&lt;li&gt;アタッチ : Sample_VPC&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;route-table&#34;&gt;Route Table&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Sample_IGW_RTB&lt;/li&gt;
&lt;li&gt;VPC : Sample_VPC&lt;/li&gt;
&lt;li&gt;ルート

&lt;ul&gt;
&lt;li&gt;送信先 : 0.0.0.0/0&lt;/li&gt;
&lt;li&gt;ターゲット : Sample_IGW&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;サブネットの関連付け

&lt;ul&gt;
&lt;li&gt;Sample_Public_1A&lt;/li&gt;
&lt;li&gt;Sample_Public_1C&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;security-group&#34;&gt;Security Group&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;EC2ダッシュボードから作成すると、送信元の設定が楽。&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Sample_ELB_Sec

&lt;ul&gt;
&lt;li&gt;InBound : HTTP, 80, MyIP（本来は0.0.0.0/0）&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Sample_WebAP_Sec

&lt;ul&gt;
&lt;li&gt;InBound : HTTP, 80, Sample_ELB_Sec.ID&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Sample_DB_Sec

&lt;ul&gt;
&lt;li&gt;InBound : MySQL, 3306, Sample_WebAP_Sec.ID&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Sample_Maintenance_Sec

&lt;ul&gt;
&lt;li&gt;InBound : SSH, 22, MyIP&lt;/li&gt;
&lt;li&gt;InBound : HTTP, 80, MyIP&lt;/li&gt;
&lt;li&gt;InBound : MySQL, 3306, MyIP -&amp;gt; いらないかも&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&#34;2-インスタンスの作成&#34;&gt;2. インスタンスの作成&lt;/h2&gt;

&lt;h3 id=&#34;rdsサブネットグループ&#34;&gt;RDSサブネットグループ&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Sample_DB_SubnetG

&lt;ul&gt;
&lt;li&gt;VPC : Sample_VPC&lt;/li&gt;
&lt;li&gt;Subnet : Sample_Private_1A, Sample_Private_1C&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;rds&#34;&gt;RDS&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Sample_DB_Master

&lt;ul&gt;
&lt;li&gt;Multi-AZ用のマスターDB&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;エンジンの選択

&lt;ul&gt;
&lt;li&gt;MySQL&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;本番稼働用？

&lt;ul&gt;
&lt;li&gt;開発／テスト&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;詳細の指定

&lt;ul&gt;
&lt;li&gt;DBエンジン :  mysql&lt;/li&gt;
&lt;li&gt;ライセンスモデル : General Public License&lt;/li&gt;
&lt;li&gt;DBエンジンのバージョン : 5.6.27&lt;/li&gt;
&lt;li&gt;DBインスタンスのクラス : db.t2.micro&lt;/li&gt;
&lt;li&gt;マルチAZ配置 : いいえ &lt;strong&gt;（開発のため）&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ストレージタイプ : 汎用（SSD）&lt;/li&gt;
&lt;li&gt;ストレージ割り当て : 5GB&lt;/li&gt;
&lt;li&gt;DBインスタンス識別子 : Sample-DB&lt;/li&gt;
&lt;li&gt;マスターユーザーの名前 : Sample_DB_User&lt;/li&gt;
&lt;li&gt;マスターパスワード : Sample_DB_Password&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;詳細設定の設定

&lt;ul&gt;
&lt;li&gt;VPC : Sample_VPC&lt;/li&gt;
&lt;li&gt;サブネットグループ : Sample_DB_SubnetG&lt;/li&gt;
&lt;li&gt;パブリックアクセス可能 : いいえ&lt;/li&gt;
&lt;li&gt;アベイラビリティーゾーン : ap-northeast-1a&lt;/li&gt;
&lt;li&gt;VPCセキュリティーグループ : Sample_DB_Sec, Sample_Maintenance_Sec&lt;/li&gt;
&lt;li&gt;データベースの名前 : Sample_DB&lt;/li&gt;
&lt;li&gt;データベースのポート : 3306&lt;/li&gt;
&lt;li&gt;DBパラメータグループ : default.mysql5.6&lt;/li&gt;
&lt;li&gt;オプショングループ : default:mysql-5-6&lt;/li&gt;
&lt;li&gt;その他はデフォルトのまま&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;ec2-1&#34;&gt;EC2-1&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Sample_Web_01

&lt;ul&gt;
&lt;li&gt;AMI : Amazon Linux&lt;/li&gt;
&lt;li&gt;t2.micro&lt;/li&gt;
&lt;li&gt;EBS : 8GB&lt;/li&gt;
&lt;li&gt;ネットワーク : Sample_VPC&lt;/li&gt;
&lt;li&gt;サブネット : Sample_Public_1A&lt;/li&gt;
&lt;li&gt;自動割り当てパブリックIP : 有効化&lt;/li&gt;
&lt;li&gt;その他はデフォルト&lt;/li&gt;
&lt;li&gt;セキュリティグループ : Sample_WebAP_Sec, Sample_Maintenance_Sec&lt;/li&gt;
&lt;li&gt;キーペア : 作成&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&#34;3-ミドルウェアのセットアップ&#34;&gt;3. ミドルウェアのセットアップ&lt;/h2&gt;

&lt;h3 id=&#34;ec2-sample-web-01&#34;&gt;EC2 : Sample_Web_01&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;基本設定

&lt;ul&gt;
&lt;li&gt;MacからSSHログイン&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ sudo yum update -y&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ sudo yum install -y httpd&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ sudo chkconfig httpd on&lt;/code&gt; &lt;strong&gt;#EC2起動時に合わせてApacheも起動させる&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ sudo service httpd start&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Macからブラウザ経由でアクセスし、Apacheぺージが表示されること&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ sudo yum install -y php&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ sudo yum install -y php-mysql&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;WordPress

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;$ mkdir ~/ttmp;cd ttmp&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ wget https://ja.wordpress.org/latest-ja.tar.gz&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ tar xzvf latest-ja.tar.gz&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ cd wordpress&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ cp wp-config-sample.php wp-config.PHP&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ vi wp-config.php&lt;/code&gt;

&lt;ul&gt;
&lt;li&gt;DB_NAME : Sample_DB&lt;/li&gt;
&lt;li&gt;DB_USER : Sample_DB_User&lt;/li&gt;
&lt;li&gt;DB_PASSWORD : Sample_DB_Password&lt;/li&gt;
&lt;li&gt;DB_HOST : Sample_DB_Masterのエンドポイント:3306&lt;/li&gt;
&lt;li&gt;認証キー : &lt;a href=&#34;https://api.wordpress.org/secret-key/1.1/salt/&#34;&gt;https://api.wordpress.org/secret-key/1.1/salt/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ sudo mv * /var/www/html/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ sudo service httpd restart&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ブラウザからSample_Web_01のパブリックIPにアクセスして、wordpressの設定を行う&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&#34;4-elbの適用&#34;&gt;4. ELBの適用&lt;/h2&gt;

&lt;h3 id=&#34;elbの作成&#34;&gt;ELBの作成&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Sample-ELB

&lt;ul&gt;
&lt;li&gt;ロードバランサーの種類 : Classic Load Balancer&lt;/li&gt;
&lt;li&gt;ロードバランサーを作成する場所 : Sample_VPC&lt;/li&gt;
&lt;li&gt;リスナー : HTTP 80&lt;/li&gt;
&lt;li&gt;サブネットの選択 : Sample_Public_1A, Sample_Public_1C&lt;/li&gt;
&lt;li&gt;セキュリティグループ : Sample_ELB_Sec&lt;/li&gt;
&lt;li&gt;ヘルスチェック

&lt;ul&gt;
&lt;li&gt;pingプロトコル : HTTP&lt;/li&gt;
&lt;li&gt;pingポート : 80&lt;/li&gt;
&lt;li&gt;pingパス : /&lt;/li&gt;
&lt;li&gt;正常の閾値 : 5 -&amp;gt; 2&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;EC2インスタンス

&lt;ul&gt;
&lt;li&gt;Sample_Web_01（Sample_Web_02はAMI作成後）&lt;/li&gt;
&lt;li&gt;クロスゾーン負荷分散の有効化 : チェック&lt;/li&gt;
&lt;li&gt;接続のストリーミングの有効化 : 300 -&amp;gt; 30 &lt;strong&gt;（WordPressの場合は必須）&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;タグ

&lt;ul&gt;
&lt;li&gt;Name : Sample_ELB&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;作成後の確認&#34;&gt;作成後の確認&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;インスタンス タブ : インスタンスがInServiceになっていること&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;wordpressの設定変更&#34;&gt;WordPressの設定変更&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Sample_Web_01のパブリックIPでWordPressにアクセス&lt;/li&gt;
&lt;li&gt;設定画面にて以下の内容をSample_ELBの「http:// + DNS名」に変更

&lt;ul&gt;
&lt;li&gt;WordPressアドレス&lt;/li&gt;
&lt;li&gt;サイトアドレス&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;elb経由での接続確認&#34;&gt;ELB経由での接続確認&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;ブラウザからSample_ELBのDNSでアクセスし、WordPressが表示されることを確認&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&#34;5-ec2の追加&#34;&gt;5. EC2の追加&lt;/h2&gt;

&lt;h3 id=&#34;ami作成&#34;&gt;AMI作成&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Sample_Web_01からAMIを作成する

&lt;ul&gt;
&lt;li&gt;停止 -&amp;gt; イメージの作成&lt;/li&gt;
&lt;li&gt;イメージ名 : Sample-WebAP-AMI&lt;/li&gt;
&lt;li&gt;AMI、スナップショットが作成される&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;ec2の作成&#34;&gt;EC2の作成&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Sample_Web_02

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Sample_Web_01のAMIから作成&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ネットワーク : Sample_VPC&lt;/li&gt;
&lt;li&gt;サブネット : Sample_Public_1C&lt;/li&gt;
&lt;li&gt;自動割り当てパブリックIP : 有効化&lt;/li&gt;
&lt;li&gt;その他はデフォルト&lt;/li&gt;
&lt;li&gt;セキュリティグループ : Sample_WebAP_Sec, Sample_Maintenance_Sec&lt;/li&gt;
&lt;li&gt;キーペア : 先に作成したもの&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;ロードバランサー配下に追加&#34;&gt;ロードバランサー配下に追加&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;インスタンス タブ -&amp;gt; インスタンスの編集 -&amp;gt; Sample_Web_02を追加&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;バランシングの確認&#34;&gt;バランシングの確認&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;各EC2上の/var/log/httpd/access_logを確認&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ sudo tail -f /var/log/httpd/access_log&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>既存のEBSをEC2のルートデバイスとしてアタッチする</title>
      <link>http://mzgkworks.com/post/attach-ebs-as-rootdevice-of-ec2/</link>
      <pubDate>Tue, 21 Feb 2017 11:51:56 +0900</pubDate>
      
      <guid>http://mzgkworks.com/post/attach-ebs-as-rootdevice-of-ec2/</guid>
      <description>

&lt;p&gt;どこにもアタッチされていないボリューム（EBS）が存在したので、EC2にアタッチして使いたい。&lt;br&gt;
EC2インスタンスの作成中に、アタッチしたいボリュームを選択できるかと思っていたが、既存ボリュームの追加ができなかった。&lt;br&gt;
なので、EC2インスタンス作成 -&amp;gt; EBSデタッチ -&amp;gt; 対象EBSアタッチの手順を踏んだ際の備忘録。&lt;br&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;EC2インスタンスとアタッチしたいボリューム（EBS）が、同じAZ内であることが前提。&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&#34;手順&#34;&gt;手順&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;EC2インスタンスを作成

&lt;ul&gt;
&lt;li&gt;作成時にEBSも作成する（後ほどデタッチ -&amp;gt; 削除）&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;EC2が起動

&lt;ul&gt;
&lt;li&gt;ルートデバイスの値を控える /dev/xvdaとか&lt;/li&gt;
&lt;li&gt;ルートデバイスをクリックして表示されるEBS IDを控える&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;EC2を停止

&lt;ul&gt;
&lt;li&gt;ルートデバイスをクリックして表示されるEBS IDをクリック&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ボリュームのデタッチ

&lt;ul&gt;
&lt;li&gt;ボリュームが表示される&lt;/li&gt;
&lt;li&gt;アクション（or 右クリック）-&amp;gt; ボリュームのデタッチ&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ボリュームのアタッチ

&lt;ul&gt;
&lt;li&gt;左ペイン -&amp;gt; ボリューム&lt;/li&gt;
&lt;li&gt;アタッチしたいボリュームを選択&lt;/li&gt;
&lt;li&gt;アクション（or 右クリック）-&amp;gt; ボリュームのアタッチ&lt;/li&gt;
&lt;li&gt;インスタンス : アタッチしたいEC2インスタンスを選択&lt;/li&gt;
&lt;li&gt;デバイス : &lt;strong&gt;2.で控えたルートデバイスの値に変更&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;アタッチ&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;確認

&lt;ul&gt;
&lt;li&gt;左ペイン -&amp;gt; インスタンス&lt;/li&gt;
&lt;li&gt;対象のインスタンスを選択&lt;/li&gt;
&lt;li&gt;ルートデバイスをクリック -&amp;gt; アタッチしたEBSであること&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;デタッチしたEBSを削除&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;注意事項&#34;&gt;注意事項&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;アタッチするEC2とEBSが同じAZであること&lt;/li&gt;
&lt;li&gt;EC2削除時のEBS合わせて削除がオフになるので、EBSは個別で削除すること&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>